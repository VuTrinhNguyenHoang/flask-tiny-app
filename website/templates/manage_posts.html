{% extends 'base.html' %} {% block content %}
<div class="container mt-4">
  <h2 class="text-center mb-4">Quáº£n lÃ½ BÃ i Viáº¿t</h2>

  <form
    id="post-form"
    method="POST"
    action="{{ url_for('posts.delete_posts') }}"
    style="position: relative"
  >
    <a
      href="{{ url_for('posts.create_post') }}"
      class="btn"
      style="
        position: absolute;
        right: -5%;
        top: 1%;
        background-color: #56d49a;
        border: 1px solid #56d49a;
      "
      >â•</a
    >
    <div class="table-responsive">
      <table class="table table-hover table-fixed">
        <thead class="table-light">
          <tr>
            <th class="col-1 text-center">
              <input type="checkbox" id="select-all" />
            </th>
            <th class="col-6">TiÃªu Ä‘á»</th>
            <th class="col-3 text-center">NgÃ y Ä‘Äƒng</th>
            <th class="col-2 text-center">HÃ nh Ä‘á»™ng</th>
          </tr>
        </thead>
        <tbody id="post-list">
          <!-- Dá»¯ liá»‡u bÃ i viáº¿t sáº½ Ä‘Æ°á»£c load tá»« JSON -->
        </tbody>
      </table>
    </div>

    <button type="submit" class="btn btn-danger mt-3">
      ğŸ—‘ XÃ³a cÃ¡c bÃ i viáº¿t Ä‘Ã£ chá»n
    </button>
  </form>

  <!-- NÃºt phÃ¢n trang -->
  <div class="pagination">
    <button id="prev-page" class="btn btn-primary" disabled>â¬… TrÆ°á»›c</button>
    <span id="page-info">Trang 1</span>
    <button id="next-page" class="btn btn-primary">Tiáº¿p â¡</button>
  </div>
</div>

<script>
  let currentPage = 1;
  const postList = document.getElementById("post-list");
  const pageInfo = document.getElementById("page-info");
  const prevPageBtn = document.getElementById("prev-page");
  const nextPageBtn = document.getElementById("next-page");

  function loadPosts(page) {
    fetch(`/api/posts?page=${page}`)
      .then((response) => response.json())
      .then((data) => {
        postList.innerHTML = "";
        data.posts.forEach((post) => {
          postList.innerHTML += `
            <tr class="post-row" data-url="/post/${post.slug}">
              <td class="text-center"><input type="checkbox" name="post_ids" value="${post.id}"></td>
              <td class="text-truncate" style="max-width: 300px; cursor: pointer;">${post.title}</td>
              <td class="text-center">${post.updated_at}</td>
              <td class="text-center">
                <a href="/edit-post/${post.slug}" class="btn btn-warning btn-sm">âœ Chá»‰nh sá»­a</a>
              </td>
            </tr>
          `;
        });

        pageInfo.innerText = `Trang ${page}`;
        currentPage = page;

        prevPageBtn.disabled = page <= 1;
        nextPageBtn.disabled = !data.has_next;

        document.querySelectorAll(".post-row").forEach((row) => {
          row.addEventListener("click", function () {
            window.location.href = this.getAttribute("data-url");
          });
        });
      });
  }

  document.getElementById("select-all").addEventListener("click", function () {
    let checkboxes = document.querySelectorAll('input[name="post_ids"]');
    checkboxes.forEach((checkbox) => (checkbox.checked = this.checked));
  });

  prevPageBtn.addEventListener("click", () => {
    if (currentPage > 1) loadPosts(currentPage - 1);
  });

  nextPageBtn.addEventListener("click", () => {
    loadPosts(currentPage + 1);
  });

  loadPosts(1);
</script>
{% endblock %}
